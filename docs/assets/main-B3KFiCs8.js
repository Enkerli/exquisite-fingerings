(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const v=11;function N(a){return a%2===0?6:5}const D=(()=>{const a=[0];for(let e=1;e<v;e++){const t=a[e-1];a.push(t+(e%2===1?4:3))}return a})();function A(a,e){return D[a]+e}function C(a,e,t=48){return t+A(a,e)}const S={portrait:{w:38,h:33}};function I(a,e,t=48){const n=S.portrait,i=e*n.w+(a%2?n.w/2:0)+t,s=(v-1-a)*n.h+t;return{x:i,y:s}}function B(a,e,t){return[[0,-t],[.866*t,-.5*t],[.866*t,.5*t],[0,+t],[-.866*t,.5*t],[-.866*t,-.5*t]].map(([i,s])=>`${a+i},${e+s}`).join(" ")}function x(a="portrait"){const e=S.portrait,t=6*e.w+120,n=v*e.h+120;return a==="portrait"?{width:t,height:n,viewBox:`0 0 ${t} ${n}`}:{width:n,height:t,viewBox:`0 0 ${n} ${t}`}}function H(a,e,t,n){const{x:i,y:s}=I(a,e),{x:o,y:c}=I(t,n);return Math.sqrt((o-i)**2+(c-s)**2)/S.portrait.w}const O={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},F={maj:{name:"Major scale",intervals:[0,2,4,5,7,9,11],type:"scale"},natmin:{name:"Natural minor",intervals:[0,2,3,5,7,8,10],type:"scale"},harmin:{name:"Harmonic minor",intervals:[0,2,3,5,7,8,11],type:"scale"},melmin:{name:"Melodic minor",intervals:[0,2,3,5,7,9,11],type:"scale"},dorian:{name:"Dorian",intervals:[0,2,3,5,7,9,10],type:"scale"},phrygian:{name:"Phrygian",intervals:[0,1,3,5,7,8,10],type:"scale"},lydian:{name:"Lydian",intervals:[0,2,4,6,7,9,11],type:"scale"},mixolydian:{name:"Mixolydian",intervals:[0,2,4,5,7,9,10],type:"scale"},locrian:{name:"Locrian",intervals:[0,1,3,5,6,8,10],type:"scale"},majpent:{name:"Major pentatonic",intervals:[0,2,4,7,9],type:"scale"},minpent:{name:"Minor pentatonic",intervals:[0,3,5,7,10],type:"scale"},majtriad:{name:"Major triad",intervals:[0,4,7],type:"chord"},mintriad:{name:"Minor triad",intervals:[0,3,7],type:"chord"},augtriad:{name:"Augmented triad",intervals:[0,4,8],type:"chord"},dimtriad:{name:"Diminished triad",intervals:[0,3,6],type:"chord"},maj7:{name:"Major 7th",intervals:[0,4,7,11],type:"chord"},min7:{name:"Minor 7th",intervals:[0,3,7,10],type:"chord"},dom7:{name:"Dominant 7th",intervals:[0,4,7,10],type:"chord"},dim7:{name:"Diminished 7th",intervals:[0,3,6,9],type:"chord"},hdim7:{name:"Half-diminished 7th",intervals:[0,3,6,10],type:"chord"},maj9:{name:"Major 9th",intervals:[0,4,7,11,14],type:"chord"},min9:{name:"Minor 9th",intervals:[0,3,7,10,14],type:"chord"},dom9:{name:"Dominant 9th",intervals:[0,4,7,10,14],type:"chord"},chromatic:{name:"Chromatic",intervals:[0,1,2,3,4,5,6,7,8,9,10,11],type:"scale"},wholeTone:{name:"Whole tone",intervals:[0,2,4,6,8,10],type:"scale"}};function T(a,e){const t=O[a];if(t===void 0)throw new Error(`Invalid key: ${a}`);const n=F[e];if(!n)throw new Error(`Invalid set type: ${e}`);const i=new Set;for(const s of n.intervals)i.add((t+s)%12);return i}function L(a){const e=new Set;return!a||!a.trim()||a.split(",").forEach(t=>{const n=Number(t.trim());Number.isNaN(n)||e.add((n%12+12)%12)}),e}function b(a){return(a%12+12)%12}class R{constructor(e){this.svg=e,this.orientation="portrait",this.labelMode="pc",this.baseMidi=48,this.highlightedPCs=new Set,this.fingeringPattern=null,this.fingeringMode=!1,this.onPadClick=null}setOrientation(e){this.orientation=e}setLabelMode(e){this.labelMode=e}setBaseMidi(e){this.baseMidi=e}setHighlightedPCs(e){this.highlightedPCs=e}setFingeringPattern(e){this.fingeringPattern=e}setFingeringMode(e){this.fingeringMode=e}setPadClickHandler(e){this.onPadClick=e}render(){const e=x(this.orientation);this.svg.setAttribute("viewBox",e.viewBox),this.svg.innerHTML="";const t=document.createElementNS("http://www.w3.org/2000/svg","g");this.orientation==="landscape"&&t.setAttribute("transform",`translate(${e.width},0) rotate(90)`);for(let n=0;n<v;n++){const i=N(n);for(let s=0;s<i;s++)this._renderPad(t,n,s)}this.svg.appendChild(t)}_renderPad(e,t,n){const{x:i,y:s}=I(t,n),o=C(t,n,this.baseMidi),c=b(o),l=document.createElementNS("http://www.w3.org/2000/svg","polygon");if(l.setAttribute("points",B(i,s,22)),l.setAttribute("class","pad"),l.setAttribute("stroke","#666"),l.setAttribute("fill","#6aa5ff"),l.setAttribute("fill-opacity","0.12"),this.highlightedPCs.has(c)&&l.classList.add("on"),this.fingeringMode&&l.classList.add("fingering-mode"),l.addEventListener("click",()=>{this.onPadClick&&this.onPadClick(t,n,o,c)}),e.appendChild(l),this._renderLabel(e,i,s,o,c),this.fingeringPattern){const r=this.fingeringPattern.getFingering(t,n);r&&this._renderFingering(e,i,s,r)}}_renderLabel(e,t,n,i,s){const o=this._getLabelText(i,s),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",t),c.setAttribute("y",n+4),c.setAttribute("text-anchor","middle"),c.setAttribute("class","label"),this.orientation==="landscape"&&c.setAttribute("transform",`rotate(-90 ${t} ${n})`),c.textContent=o,e.appendChild(c)}_renderFingering(e,t,n,i){const s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",t),s.setAttribute("y",n-8),s.setAttribute("text-anchor","middle"),s.setAttribute("class",`fing ${i.hand}`),this.orientation==="landscape"&&s.setAttribute("transform",`rotate(-90 ${t} ${n})`),s.textContent=i.finger,e.appendChild(s)}_getLabelText(e,t){switch(this.labelMode){case"pc":return t;case"note":return this._midiToNoteName(e);case"midi":return e;default:return t}}_midiToNoteName(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=b(e);return t[n]}}class ${constructor(){this.midiAccess=null,this.selectedOutput=null,this.isSupported=typeof navigator<"u"&&"requestMIDIAccess"in navigator,this.activeNotes=new Map,this.holdDuration=1e3,this.octaveRange=0,this.isHolding=!1}async init(){if(!this.isSupported)throw new Error("WebMIDI not supported in this browser");try{return this.midiAccess=await navigator.requestMIDIAccess(),this.midiAccess.onstatechange=()=>{this._onDeviceStateChange()},!0}catch(e){throw new Error(`MIDI initialization failed: ${e.message}`)}}getOutputDevices(){return this.midiAccess?Array.from(this.midiAccess.outputs.values()).map(e=>({id:e.id,name:e.name})):[]}selectOutputDevice(e){if(!this.midiAccess)return!1;const t=this.midiAccess.outputs.get(e);return t?(this.selectedOutput=t,!0):!1}setHoldDuration(e){this.holdDuration=Math.max(100,Math.min(e,3e4))}setOctaveRange(e){this.octaveRange=Math.max(0,Math.min(e,2))}noteOn(e,t=100){if(!(!this.selectedOutput||e<0||e>127))try{this.selectedOutput.send([144,e,t])}catch(n){console.error("MIDI send error:",n)}}noteOff(e){if(!(!this.selectedOutput||e<0||e>127))try{this.selectedOutput.send([128,e,0])}catch(t){console.error("MIDI send error:",t)}}playNote(e,t=100,n=null){const i=n!==null?n:this.holdDuration;this._getOctaveNotes(e).forEach(o=>{this.noteOn(o,t),this.isHolding?this.activeNotes.set(o,{velocity:t,time:Date.now()}):setTimeout(()=>{this.noteOff(o)},i)})}playChord(e,t=100,n=null,i=0){e.forEach((s,o)=>{setTimeout(()=>{this.playNote(s,t,n)},o*i)})}enableHold(){this.isHolding=!0,this.activeNotes.clear()}disableHold(){this.isHolding=!1,this.releaseAllNotes()}releaseAllNotes(){for(const[e]of this.activeNotes)this.noteOff(e);this.activeNotes.clear()}allNotesOff(){if(this.selectedOutput){try{for(let e=0;e<16;e++)this.selectedOutput.send([176+e,123,0])}catch(e){console.error("MIDI send error:",e)}this.activeNotes.clear()}}_getOctaveNotes(e){const t=[e];for(let n=1;n<=this.octaveRange;n++){const i=e+12*n,s=e-12*n;i<=127&&t.push(i),s>=0&&t.push(s)}return t}_onDeviceStateChange(){this.selectedOutput&&(this.midiAccess.outputs.get(this.selectedOutput.id)||(this.selectedOutput=null))}getStatus(){var e;return{isSupported:this.isSupported,isInitialized:this.midiAccess!==null,hasDevice:this.selectedOutput!==null,deviceName:((e=this.selectedOutput)==null?void 0:e.name)||null,isHolding:this.isHolding,activeNoteCount:this.activeNotes.size,holdDuration:this.holdDuration,octaveRange:this.octaveRange}}}const g=new $;class p{constructor(e="Untitled"){this.name=e,this.fingerings=new Map,this.metadata={key:null,setType:null,baseMidi:48,createdAt:Date.now(),modifiedAt:Date.now()}}setFingering(e,t,n,i){const s=`${e},${t}`;this.fingerings.set(s,{hand:n,finger:i}),this.metadata.modifiedAt=Date.now()}getFingering(e,t){const n=`${e},${t}`;return this.fingerings.get(n)||null}removeFingering(e,t){const n=`${e},${t}`;this.fingerings.delete(n),this.metadata.modifiedAt=Date.now()}clearAll(){this.fingerings.clear(),this.metadata.modifiedAt=Date.now()}getPadsForHand(e){const t=[];for(const[n,i]of this.fingerings)if(i.hand===e){const[s,o]=n.split(",").map(Number);t.push({row:s,col:o,finger:i.finger})}return t}getPadsForFinger(e,t=null){const n=[];for(const[i,s]of this.fingerings)if(s.finger===e&&(!t||s.hand===t)){const[o,c]=i.split(",").map(Number);n.push({row:o,col:c,hand:s.hand})}return n}toJSON(){return{name:this.name,fingerings:Array.from(this.fingerings.entries()),metadata:this.metadata}}static fromJSON(e){const t=new p(e.name);return t.fingerings=new Map(e.fingerings),t.metadata=e.metadata,t}}class _{constructor(){this.fingerWeights={1:.8,2:1,3:.9,4:.6,5:.4},this.handSizes={small:{maxStretch:2.5,comfortableStretch:1.5},medium:{maxStretch:3,comfortableStretch:2},large:{maxStretch:3.5,comfortableStretch:2.5}},this.currentHandSize="medium"}setHandSize(e){this.handSizes[e]&&(this.currentHandSize=e)}analyzePattern(e){let t=100;const n=[];return["left","right"].forEach(i=>{const s=e.getPadsForHand(i);if(s.length===0)return;const o=this._analyzeSpan(s,i,n);t-=o;const c=this._analyzeFingerStrength(s,n);t+=c;const l=this._analyzeFingerCrossings(s,i,n);t-=l}),{score:Math.max(0,Math.min(100,t)),issues:n,recommendation:this._getRecommendation(t)}}suggestFingerings(e,t,n=48){if(e.length===0)return[];const i=new Map;e.forEach(c=>{const l=c.row===0?c.col:(c.row%2===1?4:3)*c.row+c.col,r=n+l,d=r%12;if(!i.has(d))i.set(d,{...c,pc:d,midiNote:r});else{const u=i.get(d);(c.row<u.row||c.row===u.row&&c.col<u.col)&&i.set(d,{...c,pc:d,midiNote:r})}});const s=Array.from(i.values());let o=s;return s.length>5&&(o=[...s].sort((c,l)=>{const r=c.row*2+c.col,d=l.row*2+l.col;return r-d}).slice(0,5)),this._assignFingersAnatomically(o,t)}_assignFingersAnatomically(e,t){if(e.length===0)return[];const i=[...e].sort((r,d)=>r.row!==d.row?r.row-d.row:t==="right"?r.col-d.col:d.col-r.col)[0],s=[];s.push({row:i.row,col:i.col,hand:t,finger:1,score:1});const o=e.filter(r=>!(r.row===i.row&&r.col===i.col));if(o.length===0)return s;const c=o.map(r=>{const d=r.row-i.row,u=r.col-i.col,E=Math.sqrt(d*d+u*u),P=t==="right"?d+u:d-u;return{pad:r,distance:E,directionScore:P,score:P*2-E*.5}}).sort((r,d)=>d.score-r.score),l=[2,3,4,5];return c.slice(0,4).forEach((r,d)=>{s.push({row:r.pad.row,col:r.pad.col,hand:t,finger:l[d],score:.8})}),s}_analyzeSpan(e,t,n){const i=this.handSizes[this.currentHandSize];let s=0;const o=[...e].sort((c,l)=>c.finger-l.finger);for(let c=0;c<o.length-1;c++){const l=o[c],r=o[c+1];if(l.finger===r.finger)continue;const d=H(l.row,l.col,r.row,r.col);d>i.maxStretch?(s+=20,n.push({type:"excessive_stretch",hand:t,fingers:[l.finger,r.finger],distance:d})):d>i.comfortableStretch&&(s+=5,n.push({type:"uncomfortable_stretch",hand:t,fingers:[l.finger,r.finger],distance:d}))}return s}_analyzeFingerStrength(e,t){let n=0;return e.forEach(i=>{const s=this.fingerWeights[i.finger];s>=.9?n+=2:s<=.5&&(n-=1)}),n}_analyzeFingerCrossings(e,t,n){let i=0;const s=new Set,o=[...e].sort((c,l)=>c.finger-l.finger);for(let c=0;c<o.length-1;c++){const l=o[c],r=o[c+1],d=`${l.finger}-${r.finger}`;s.has(d)||l.row>r.row&&(i+=5,s.add(d),n.push({type:"finger_crossing",hand:t,fingers:[l.finger,r.finger]}))}return i}_getRecommendation(e){return e>=90?"Excellent ergonomics!":e>=75?"Good fingering, comfortable to play":e>=60?"Acceptable, but could be improved":e>=40?"Uncomfortable, consider revising":"Poor ergonomics, recommend different fingering"}_suggestMultiHandFingering(e){const t=Math.floor(e.length/2),n=e.slice(0,t),i=e.slice(t);return[...this.suggestFingerings(n,"left"),...this.suggestFingerings(i,"right")]}}const f=new _,h={PATTERNS:"exquisPatterns",SETTINGS:"exquisSettings",RECENT_PATTERNS:"exquisRecentPatterns"};function k(a,e){const t=y();t[a]={...e,savedAt:Date.now()},localStorage.setItem(h.PATTERNS,JSON.stringify(t)),J(a)}function z(a){return y()[a]||null}function q(a){const e=y();return e[a]?(delete e[a],localStorage.setItem(h.PATTERNS,JSON.stringify(e)),W(a),!0):!1}function y(){try{const a=localStorage.getItem(h.PATTERNS);return a?JSON.parse(a):{}}catch(a){return console.error("Error loading patterns:",a),{}}}function j(){return Object.keys(y()).sort()}function m(a){localStorage.setItem(h.SETTINGS,JSON.stringify(a))}function G(){try{const a=localStorage.getItem(h.SETTINGS);return a?JSON.parse(a):M()}catch(a){return console.error("Error loading settings:",a),M()}}function M(){return{orientation:"portrait",labelMode:"pc",baseMidi:48,midiHoldDuration:1e3,midiOctaveRange:0,handSize:"medium",theme:"light"}}function J(a){let e=w();e=e.filter(t=>t!==a),e.unshift(a),e=e.slice(0,10),localStorage.setItem(h.RECENT_PATTERNS,JSON.stringify(e))}function W(a){let e=w();e=e.filter(t=>t!==a),localStorage.setItem(h.RECENT_PATTERNS,JSON.stringify(e))}function w(){try{const a=localStorage.getItem(h.RECENT_PATTERNS);return a?JSON.parse(a):[]}catch{return[]}}class U{constructor(){this.settings=G(),this.currentPattern=new p,this.currentFinger=1,this.currentHand="right",this.fingeringMode=!1,this.gridElement=document.getElementById("grid"),this.gridRenderer=new R(this.gridElement),this.initUI(),this.loadStoredSettings(),this.render()}initUI(){var o,c,l;document.querySelectorAll('input[name="ori"]').forEach(r=>{r.addEventListener("change",()=>{this.settings.orientation=r.value,this.render(),m(this.settings)})}),document.querySelectorAll('input[name="lab"]').forEach(r=>{r.addEventListener("change",()=>{this.settings.labelMode=r.value,this.render(),m(this.settings)})}),document.getElementById("key").addEventListener("change",()=>{this.render(),this.updateMIDIHoldIfActive()}),document.getElementById("set").addEventListener("change",r=>{const d=r.target.value==="custom";document.getElementById("customPC").disabled=!d,this.render(),this.updateMIDIHoldIfActive()}),document.getElementById("customPC").addEventListener("input",()=>{this.render(),this.updateMIDIHoldIfActive()}),document.getElementById("baseMidi").addEventListener("input",r=>{this.settings.baseMidi=parseInt(r.target.value),this.render(),this.updateMIDIHoldIfActive(),m(this.settings)}),document.getElementById("fingeringMode").addEventListener("change",r=>{this.fingeringMode=r.target.checked,document.getElementById("fingeringModeInfo").style.display=this.fingeringMode?"block":"none",document.querySelectorAll(".finger-btn").forEach(d=>{d.disabled=!this.fingeringMode}),this.render()}),document.getElementById("fingeringHand").addEventListener("change",r=>{this.currentHand=r.target.value});for(let r=1;r<=5;r++)document.getElementById(`fingBtn${r}`).addEventListener("click",()=>{this.currentFinger=r,this.updateFingerButtonState()});document.addEventListener("keydown",r=>{this.fingeringMode&&r.key>="1"&&r.key<="5"&&(this.currentFinger=parseInt(r.key),this.updateFingerButtonState())}),document.getElementById("clearFingerings").addEventListener("click",()=>{this.currentPattern.clearAll(),this.render()}),document.getElementById("suggestFingerings").addEventListener("click",()=>{this.suggestFingerings()}),document.getElementById("savePattern").addEventListener("click",()=>this.saveCurrentPattern()),document.getElementById("loadPattern").addEventListener("change",r=>{r.target.value&&this.loadPatternByName(r.target.value)}),document.getElementById("deletePattern").addEventListener("click",()=>this.deleteCurrentPattern()),document.getElementById("enableMidi").addEventListener("click",()=>this.initMIDI()),document.getElementById("midiDevice").addEventListener("change",r=>{r.target.value&&(g.selectOutputDevice(r.target.value),this.updateMIDIStatus())});const e=document.getElementById("midiHoldDuration"),t=document.getElementById("holdDurationValue");e==null||e.addEventListener("input",r=>{const d=parseInt(r.target.value);t.textContent=`${(d/1e3).toFixed(1)}s`,g.setHoldDuration(d),this.settings.midiHoldDuration=d,m(this.settings)});const n=document.getElementById("midiOctaveRange"),i=document.getElementById("octaveRangeValue");n==null||n.addEventListener("input",r=>{const d=parseInt(r.target.value);i.textContent=d===0?"0 (none)":`±${d}`,g.setOctaveRange(d),this.settings.midiOctaveRange=d,m(this.settings)});const s=document.getElementById("midiHoldToggle");s==null||s.addEventListener("change",r=>{r.target.checked?(g.enableHold(),this.sendHighlightedNotes()):g.disableHold()}),(o=document.getElementById("midiSendHighlighted"))==null||o.addEventListener("click",()=>{this.sendHighlightedNotes()}),(c=document.getElementById("analyzeErgo"))==null||c.addEventListener("click",()=>{this.analyzeErgonomics()}),(l=document.getElementById("handSize"))==null||l.addEventListener("change",r=>{f.setHandSize(r.target.value),this.settings.handSize=r.target.value,m(this.settings)}),this.gridRenderer.setPadClickHandler((r,d,u,E)=>{this.fingeringMode?this.handleFingeringClick(r,d):g.playNote(u)})}loadStoredSettings(){document.querySelector(`input[name="ori"][value="${this.settings.orientation}"]`).checked=!0,document.querySelector(`input[name="lab"][value="${this.settings.labelMode}"]`).checked=!0,document.getElementById("baseMidi").value=this.settings.baseMidi;const e=document.getElementById("midiHoldDuration");e&&(e.value=this.settings.midiHoldDuration,document.getElementById("holdDurationValue").textContent=`${(this.settings.midiHoldDuration/1e3).toFixed(1)}s`,g.setHoldDuration(this.settings.midiHoldDuration));const t=document.getElementById("midiOctaveRange");if(t){t.value=this.settings.midiOctaveRange;const i=this.settings.midiOctaveRange;document.getElementById("octaveRangeValue").textContent=i===0?"0 (none)":`±${i}`,g.setOctaveRange(i)}const n=document.getElementById("handSize");n&&(n.value=this.settings.handSize,f.setHandSize(this.settings.handSize)),this.updatePatternList()}render(){this.gridRenderer.setOrientation(this.settings.orientation),this.gridRenderer.setLabelMode(this.settings.labelMode),this.gridRenderer.setBaseMidi(this.settings.baseMidi),this.gridRenderer.setHighlightedPCs(this.getHighlightedPCs()),this.gridRenderer.setFingeringPattern(this.currentPattern),this.gridRenderer.setFingeringMode(this.fingeringMode),this.gridRenderer.render()}getHighlightedPCs(){const e=document.getElementById("set").value;if(e==="custom"){const t=document.getElementById("customPC").value;return L(t)}else{const t=document.getElementById("key").value;return T(t,e)}}handleFingeringClick(e,t){const n=this.currentPattern.getFingering(e,t);n&&n.hand===this.currentHand&&n.finger===this.currentFinger?this.currentPattern.removeFingering(e,t):this.currentPattern.setFingering(e,t,this.currentHand,this.currentFinger),this.render()}updateFingerButtonState(){for(let e=1;e<=5;e++){const t=document.getElementById(`fingBtn${e}`);t.style.opacity=e===this.currentFinger?"1":"0.5"}}suggestFingerings(){const e=this.getHighlightedPCs();if(e.size===0){alert("No notes highlighted. Please select a key and scale/chord first.");return}const t=[];for(let o=0;o<11;o++)for(let c=0;c<(o%2===0?6:5);c++){const l=o===0?c:(o%2===1?4:3)*o+c,d=(this.settings.baseMidi+l)%12;e.has(d)&&t.push({row:o,col:c})}if(t.length===0){alert("No pads match the selected notes in the current range.");return}const n=document.getElementById("fingeringHand").value,i=f.suggestFingerings(t,n,this.settings.baseMidi);this.currentPattern.getPadsForHand(n).forEach(o=>{this.currentPattern.removeFingering(o.row,o.col)}),i.forEach(o=>{this.currentPattern.setFingering(o.row,o.col,o.hand,o.finger)}),this.render(),alert(`Suggested fingerings for ${i.length} pads (${n} hand)`)}saveCurrentPattern(){const e=document.getElementById("patternName").value.trim();if(!e){alert("Please enter a pattern name");return}const t={...this.currentPattern.toJSON(),key:document.getElementById("key").value,set:document.getElementById("set").value,baseMidi:this.settings.baseMidi};k(e,t),this.updatePatternList(),document.getElementById("patternName").value="",alert(`Pattern "${e}" saved!`)}loadPatternByName(e){const t=z(e);if(!t){alert(`Pattern "${e}" not found`);return}this.currentPattern=p.fromJSON(t),document.getElementById("key").value=t.key,document.getElementById("set").value=t.set,this.settings.baseMidi=t.baseMidi,document.getElementById("baseMidi").value=t.baseMidi,this.render()}deleteCurrentPattern(){const e=document.getElementById("loadPattern").value;if(!e){alert("Please select a pattern to delete");return}confirm(`Delete pattern "${e}"?`)&&(q(e),this.updatePatternList(),document.getElementById("loadPattern").value="")}updatePatternList(){const e=document.getElementById("loadPattern"),t=j();e.innerHTML='<option value="">-- Select Pattern --</option>',t.forEach(n=>{const i=document.createElement("option");i.value=n,i.textContent=n,e.appendChild(i)})}async initMIDI(){try{await g.init(),this.updateMIDIDeviceList(),this.updateMIDIStatus()}catch(e){this.updateMIDIStatus(e.message)}}updateMIDIDeviceList(){const e=document.getElementById("midiDevice"),t=g.getOutputDevices();e.innerHTML='<option value="">-- Select device --</option>',t.forEach(n=>{const i=document.createElement("option");i.value=n.id,i.textContent=n.name,e.appendChild(i)}),e.disabled=t.length===0}updateMIDIStatus(e=null){const t=g.getStatus(),n=document.getElementById("midiStatus");e?(n.textContent=`Error: ${e}`,n.className="error-box"):t.isSupported?t.isInitialized?t.hasDevice?(n.textContent=`Connected: ${t.deviceName}`,n.className="success-box"):(n.textContent="MIDI ready - select a device",n.className="info-box"):(n.textContent="MIDI not initialized",n.className="warning-box"):(n.textContent="WebMIDI not supported (use Chrome/Brave/Edge)",n.className="warning-box")}sendHighlightedNotes(){const e=this.getHighlightedPCs(),t=[];for(let n=0;n<39;n++){const i=this.settings.baseMidi+n,s=i%12;e.has(s)&&t.push(i)}g.playChord(t,100,null,20)}updateMIDIHoldIfActive(){const e=document.getElementById("midiHoldToggle");e&&e.checked&&g.getStatus().isHolding&&(g.releaseAllNotes(),this.sendHighlightedNotes())}analyzeErgonomics(){const e=f.analyzePattern(this.currentPattern),t=document.getElementById("ergoResult");t&&(t.innerHTML=`
        <div class="score-display">
          <div class="score-label">Ergonomic Score</div>
          <div class="score-value">${e.score}</div>
          <div class="score-recommendation">${e.recommendation}</div>
        </div>
        ${e.issues.length>0?`
          <h4>Issues Found:</h4>
          <ul class="issue-list">
            ${e.issues.map(n=>`<li class="issue-item">${this.formatIssue(n)}</li>`).join("")}
          </ul>
        `:'<div class="success-box">No ergonomic issues found!</div>'}
      `)}formatIssue(e){switch(e.type){case"excessive_stretch":return`Excessive stretch between fingers ${e.fingers.join(" and ")} (${e.hand} hand)`;case"uncomfortable_stretch":return`Uncomfortable stretch between fingers ${e.fingers.join(" and ")} (${e.hand} hand)`;case"finger_crossing":return`Possible finger crossing: fingers ${e.fingers.join(" and ")} (${e.hand} hand)`;default:return JSON.stringify(e)}}}document.addEventListener("DOMContentLoaded",()=>{window.app=new U});
